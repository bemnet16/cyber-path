The first stage in establishing map “need to establish which services are running on the targets” of attacking landscape is something called port scanning.
If we do not know which of these ports a server has open, then we do not have a hope of successfully attacking the target; thus, it is crucial that we begin any attack with a port scan.
This can be accomplished in a variety of ways – usually using a tool called ***nmap***.

#### nmap Switchs
*-sT(TCP Connect scans)*
-  works by performing the three-way handshake with each target port in turn.
- If the request is sent to an _open_ port, the target will respond with a TCP packet with the SYN/ACK flags set.
- If the connection does not exist (CLOSED), then a reset is sent in response to any incoming segment except another reset.
*-sS( SYN scans)*
- Sometimes referred to as "_Half-open"_ scans, or _"Stealth"_ scans.
-  sends back a RST TCP packet after receiving a SYN/ACK from the server.
-  require *sudo* permissions in order to work correctly in Linux.
- SYN scans are the default scans used by Nmap _if run with sudo permissions_.
*-sU(UDP Scans)*
- UDP connections rely on sending packets to a target port and essentially hoping that they make it.
- lack of acknowledgement makes UDP significantly more difficult (and much slower) to scan.
- packet sent to an *open* UDP port, there should be no response, Nmap refers it to the port as being `open|filtered`.
- packet sent to a _closed_ UDP port, the target should respond with an ICMP (ping) packet containing a message that the port is unreachable.
*-sN(NULL scans)*
-  the TCP request is sent with no flags set at all.
- As per the RFC, the target host should respond with a RST if the port is closed.
*-sF(FIN scans)*
- request is sent with the FIN flag (usually used to gracefully close an active connection). Once again, Nmap expects a RST if the port is closed.
*-sX(Xmas scans)*
- send a malformed TCP packet and expects a RST response for closed ports.

`NULL, FIN and Xmas scans will only ever identify ports as being _open|filtered_, _closed_, or _filtered_. If a port is identified as filtered with one of these scans then it is usually because the target has responded with an ICMP unreachable packet.`

`Many firewalls are configured to drop incoming TCP packets to blocked ports which have the SYN flag set (thus blocking new connection initiation requests). By sending requests which do not contain the SYN flag, we effectively bypass this kind of firewall. (those 3 scans)`

*-sn(ICMP Network Scanning)*
- It used to see which IP addresses contain active hosts, and which do not.
- Nmap sends an ICMP packet to each possible IP address for the specified network.When it receives a response, it marks the IP address that responded as being alive.
- It tells nmap not to scan any ports -- forcing it to rely primarily on ICMP echo packets (or ARP requests on a local network, if run with sudo or directly as the root user) to identify targets.
	- e.g - `nmap -sn 192.168.0.0/24`
	
*Nmap Scripting Engine (NSE)*
-  NSE Scripts are written in the _Lua_ programming language, and can be used to do a variety of things: from scanning for vulnerabilities, to automating exploits for them.
- There are many categories available. Some useful categories include:
	- safe, intrusive, vuln, exploit, auth, brute, discover

**Firewall Evasion**
- There are some techniques for bypassing firewalls (think stealth scans, along with NULL, FIN and Xmas scans).
- there is another very common firewall configuration which it's imperative we know how to bypass.
- *-Pn* 
	- Tells nmap to not bother pinging the host before scanning it.(This means that Nmap will always treat the target host(s) as being alive, effectively bypassing the ICMP block).
- *-f*
	- Used to fragment the packets (i.e. split them into smaller pieces) making it less likely that the packets will be detected by a firewall or IDS.
- *--scan-delay < time> ms* -  used to add a delay between packets sent.
	- *--badsum* - used to generate in invalid checksum for packets.




some examples that use scripts to perform enumeration:

- There is a script to *enumerate shares*
	`nmap -p 445 --script=smb-enum-shares.nse,smb-enum-users.nse 10.10.13.162
	`
-  *enumerate network* file system
	`nmap -p 111 --script=nfs-ls,nfs-statfs,nfs-showmount 10.10.13.162`

