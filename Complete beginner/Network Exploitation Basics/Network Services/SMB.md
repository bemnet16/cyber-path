### SMB  /Server Message Block Protocol/
- It is a client-server communication protocol used for sharing access to files, printers, serial ports and other resources on a network.
- The SMB protocol enables applications and their users to access files on remote servers, as well as connect to other resources, including printers, mailslots and named pipes.

##### How does the SMB protocol work?
Known as a _response-request protocol_, the SMB protocol is one of the most common methods used for network communications. In this model, the client sends an SMB request to the server to initiate the connection. When the server receives the request, it replies by sending an SMB response back to the client, establishing the communication channel necessary for a two-way conversation.

![SMB request and response](https://cdn.ttgtmedia.com/rms/onlineImages/networking-smb_mobile.jpg)

#### Enumerating SMB

**Enumeration**
Enumeration is the process of gathering information on a target in order to find potential attack vectors and aid in exploitation.
Enumeration can be used to gather usernames, passwords, network information, hostnames, application data, services, or any other information that may be valuable to an attacker.

**SMB**
SMB can often be a great starting point for an attacker looking to discover sensitive information.

**Port scanning**
The first step of enumeration is to conduct a port scan, to find out as much information as you can about the services, applications, structure and operating system of the target machine.

[**Enum4Linux**](Tools)
The syntax of Enum4Linux is nice and simple: `"enum4linux [options] ip" `

###### TAG            FUNCTION  

-U             get userlist  
-M             get machine list  
-N             get namelist dump (different from -U and-M)  
-S             get sharelist  
-P             get password policy information  
-G             get group and member list

-a             all of the above (full basic enumeration)


#### Exploiting SMB

*Types of SMB Exploit*
- CVE vulnerability
- misconfigurations in the system

*SMBClient*
We can remotely access the SMB share using the syntax: `smbclient //[IP]/[SHARE]`
	Followed by the tags:
-U [name] : to specify the user
-p [port] : to specify the port


Here are some common commands used with **Samba**:

1. **smbclient**: This command allows you to access SMB/CIFS shares on remote Windows or Samba servers. You can use it to browse, view, and manipulate files on these shares.
    `smbclient //server/share -U username`
    
2. **smbpasswd**: This command is used to change the password for a user in the Samba password database.
    `smbpasswd -a username`
    
3. **testparm**: This command checks the syntax of the Samba configuration file (smb.conf) for errors.
    `testparm`
    
4. **smbstatus**: This command displays information about current Samba connections, including connected users, shares, and active processes.
    `smbstatus`
    
5. **smbcontrol**: This command is used to send control messages to running Samba daemons, such as restarting or reloading the configuration.
    `smbcontrol all reload-config`
    
6. **net**: The `net` command provides various utilities for managing Samba, including joining a Samba server to a domain, managing users, shares, and printers.
    `net join -U username`
    
7. **smbpasswd**: This command allows you to manage Samba user passwords, including adding, deleting, and changing passwords.
    `smbpasswd -a username`